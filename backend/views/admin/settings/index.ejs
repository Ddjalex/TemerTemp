<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .temer-green { background-color: #7CB342; }
        .temer-green-dark { background-color: #689F38; }
        .bg-temer-green { background-color: #7CB342; }
        .bg-temer-green-dark { background-color: #689F38; }
        .text-temer-green { color: #7CB342; }
        .border-temer-green { border-color: #7CB342; }
    </style>
</head>
<body class="bg-gray-50">

<!-- Admin Navigation -->
<nav class="bg-white shadow-lg border-b-2 border-temer-green">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex items-center space-x-8">
                <div class="flex-shrink-0 flex items-center">
                    <img src="/uploads/temer-logo.jpg" alt="Temer Properties Logo" class="h-8 w-8 rounded mr-3">
                    <span class="text-xl font-bold text-gray-900">Temer Properties</span>
                </div>
                <div class="flex items-center space-x-1">
                    <a href="/admin/dashboard" class="text-gray-500 hover:text-gray-700">Dashboard</a>
                    <span class="text-gray-500">/</span>
                    <span class="text-gray-900 font-medium">Settings</span>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="w-8 h-8 bg-temer-green rounded-full flex items-center justify-center">
                    <span class="text-white font-semibold text-sm"><%= user.fullName.split(' ').map(n => n[0]).join('') %></span>
                </div>
                <a href="/admin/logout" class="text-red-600 hover:text-red-800">
                    <i class="fas fa-sign-out-alt mr-1"></i> Logout
                </a>
            </div>
        </div>
    </div>
</nav>

<main class="py-6">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Settings</h1>

        <!-- Settings Cards -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Account Settings -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-temer-green bg-opacity-10 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-user text-temer-green"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900">Account Settings</h2>
                        <p class="text-sm text-gray-600">Manage your account security</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between py-3 border-b border-gray-100">
                        <div>
                            <p class="font-medium text-gray-900">Change Password</p>
                            <p class="text-sm text-gray-600">Update your account password</p>
                        </div>
                        <a href="/admin/settings/password" class="bg-temer-green hover:bg-temer-green-dark text-white px-4 py-2 rounded-lg text-sm">
                            <i class="fas fa-key mr-1"></i> Change
                        </a>
                    </div>
                    
                    <div class="flex items-center justify-between py-3">
                        <div>
                            <p class="font-medium text-gray-900">Profile Information</p>
                            <p class="text-sm text-gray-600"><%= user.fullName %> - <%= user.email %></p>
                        </div>
                        <span class="text-temer-green text-sm font-medium">
                            <%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-phone text-blue-600"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900">Contact Information</h2>
                        <p class="text-sm text-gray-600">Update company contact details</p>
                    </div>
                </div>
                
                <form id="contactForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input type="tel" name="phone" 
                               value="<%= settings.contact && settings.contact.find(s => s.key === 'contact_phone') ? settings.contact.find(s => s.key === 'contact_phone').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="+251 911 234567">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">WhatsApp Number</label>
                        <input type="tel" name="whatsapp"
                               value="<%= settings.contact && settings.contact.find(s => s.key === 'contact_whatsapp') ? settings.contact.find(s => s.key === 'contact_whatsapp').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="+251 911 234567">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                        <input type="email" name="email"
                               value="<%= settings.contact && settings.contact.find(s => s.key === 'contact_email') ? settings.contact.find(s => s.key === 'contact_email').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="info@temerproperties.com">
                    </div>
                    
                    <button type="submit" class="w-full bg-temer-green hover:bg-temer-green-dark text-white py-2 rounded-lg font-medium">
                        <i class="fas fa-save mr-2"></i>Update Contact Info
                    </button>
                </form>
            </div>

            <!-- Social Media -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-share-alt text-purple-600"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900">Social Media Links</h2>
                        <p class="text-sm text-gray-600">Update your social media presence</p>
                    </div>
                </div>
                
                <form id="socialForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fab fa-facebook text-blue-600 mr-2"></i>Facebook URL
                        </label>
                        <input type="url" name="facebook" 
                               value="<%= settings.social && settings.social.find(s => s.key === 'social_facebook') ? settings.social.find(s => s.key === 'social_facebook').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="https://facebook.com/temerproperties">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fab fa-twitter text-blue-400 mr-2"></i>Twitter URL
                        </label>
                        <input type="url" name="twitter"
                               value="<%= settings.social && settings.social.find(s => s.key === 'social_twitter') ? settings.social.find(s => s.key === 'social_twitter').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="https://twitter.com/temerproperties">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fab fa-instagram text-pink-600 mr-2"></i>Instagram URL
                        </label>
                        <input type="url" name="instagram"
                               value="<%= settings.social && settings.social.find(s => s.key === 'social_instagram') ? settings.social.find(s => s.key === 'social_instagram').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="https://instagram.com/temerproperties">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fab fa-linkedin text-blue-700 mr-2"></i>LinkedIn URL
                        </label>
                        <input type="url" name="linkedin"
                               value="<%= settings.social && settings.social.find(s => s.key === 'social_linkedin') ? settings.social.find(s => s.key === 'social_linkedin').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="https://linkedin.com/company/temerproperties">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fab fa-youtube text-red-600 mr-2"></i>YouTube URL
                        </label>
                        <input type="url" name="youtube"
                               value="<%= settings.social && settings.social.find(s => s.key === 'social_youtube') ? settings.social.find(s => s.key === 'social_youtube').value : '' %>"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-temer-green focus:border-temer-green"
                               placeholder="https://youtube.com/temerproperties">
                    </div>
                    
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-medium">
                        <i class="fas fa-save mr-2"></i>Update Social Media Links
                    </button>
                </form>
            </div>
        </div>

        <!-- Other Settings Categories -->
        <% if (Object.keys(settings).length > 0) { %>
            <div class="mt-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Other Settings</h2>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <% Object.entries(settings).forEach(([category, categorySettings]) => { %>
                        <% if (category !== 'contact') { %>
                            <div class="mb-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4 capitalize"><%= category %> Settings</h3>
                                <div class="space-y-4">
                                    <% categorySettings.forEach(setting => { %>
                                        <div class="flex items-center justify-between py-2">
                                            <div>
                                                <p class="font-medium text-gray-900"><%= setting.key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %></p>
                                                <% if (setting.description) { %>
                                                    <p class="text-sm text-gray-600"><%= setting.description %></p>
                                                <% } %>
                                            </div>
                                            <div class="text-sm text-gray-900">
                                                <%= setting.value %>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                            </div>
                        <% } %>
                    <% }); %>
                </div>
            </div>
        <% } %>
    </div>
</main>

<script>
// Contact form submission
document.getElementById('contactForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    fetch('/admin/settings/contact', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4';
            successDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>' + data.message;
            this.insertBefore(successDiv, this.firstChild);
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        } else {
            alert(data.message || 'Failed to update contact information');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while updating contact information');
    });
});

// Social media form submission
document.getElementById('socialForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    fetch('/admin/settings/social', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4';
            successDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>' + data.message;
            this.insertBefore(successDiv, this.firstChild);
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        } else {
            alert(data.message || 'Failed to update social media links');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while updating social media links');
    });
});
</script>

</body>
</html>